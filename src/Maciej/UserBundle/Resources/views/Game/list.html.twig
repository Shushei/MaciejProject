{% extends 'MaciejUserBundle:Default:Default.html.twig' %}

{% set active = 'CompanyList'%}

{% block title %}List{% endblock %}


{% block body %} 



 
    <div id="loading"></div>
    {%for p in 1..pages %}
        <a href="{{ path('usergamesearch', {'pagee' : p, 'url' : criteria})}}">{{p}}</a>

    {%endfor%}

      <div class="container">

      <!-- Page Heading/Breadcrumbs -->
      <h1 class="mt-4 mb-3"> Companies List
        <small></small>
      </h1>

      <ol class="breadcrumb">
        <li class="breadcrumb-item">
          <a href="index.html">Home</a>
        </li>
        <li class="breadcrumb-item active">Games List</li>
      </ol>
    
        {% for game in games %}
            
           <div class="row">
        <div class="col-md-7">
          <a href="#">
            <img class="img-fluid rounded mb-3 mb-md-0" src="{{asset(game.getLogoLink())}}" alt="">
          </a>
        </div>
        <div class="col-md-5">
          <h3> {{ game.getTitle}}</h3>
          <p>
              {{ dump(game)}}
              Game Title: {{ game.getTitle}}</br>
              Released By: {{game.getCompany.getCompany()}}
              Release Date : {{ game.getReleaseDate().format('Y-m-d')}} </br>
              Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laudantium veniam exercitationem expedita laborum at voluptate. Labore, voluptates totam at aut nemo deserunt rem magni pariatur quos perspiciatis atque eveniet unde.</p>
          <a class="btn btn-primary" href={{ path('usergamesingle', {'id' : game.getId()})}}>View Game
            <span class="glyphicon glyphicon-chevron-right"></span>
          </a>
        </div>
      </div>
 <hr>
        {% endfor %}
                <p id="add">

    <button id="load-more">Load More</button>
    <script type="text/javascript">
        page = 1;
        var size ={{size}}
                //Ten if jest tylko dlatego że mamy 2 typy poszukiwań
                if (criteria !== 'undefined' && criteria !== {{criteria|json_encode|raw}}){
        var criteria ={{criteria|json_encode|raw}}
        }
        $("#load-more").click(function () {
        page = page + 1;
        $.ajax({
        method: "GET",
                url: "http://shushei.site/app_dev.php/api2/game/ajax/update",
                dataType: "json",
                contentType: "application/json",
                data: {page: page, size: size, criteria},
                success: function (a) {
               console.log(a);
                $.each(a, function (key, element) {
                     console.log(element);
                     console.log(element.logolink);
                     alert(element.title);
                var date = new Date(element.release_date);
                var day = date.getDate();
                var month = date.getMonth() + 1;
                var year = date.getFullYear();
                var id = element.id;
                var path = "{{ path('usergamesingle', {'id' : 'element.id'})}}";
                path = path.replace('element.id', element.id);
                var asset = "{{asset('logolink')}}";
                 if (typeof element.logolink !== 'undefined'){
                asset = "http://placehold.it/700x300";
            } else {
                asset = asset.replace('logolink', element.logolink);
                alert(JSON.stringify(element.logolink));
            }
                $("#add").before(
                        $("<div class=row id=game" + element.id + "></div>").html(
                       " <div class='col-md-7'>"+
          "<a href=#>"+
            "<img class='img-fluid rounded mb-3 mb-md-0' id=gamelogolink"+element.id+" src='' alt=''>"+
          "</a></div>"+
                         "<div class='col-md-5'>"+
          "<h3>" + element.title+"</h3>"+
          "<p>" +
              "Game Title: "+ element.title +"</br>"+
              "Released By: "+element.company.company+ "</br>"+
              "Release Date : "+year+"-"+month+"-"+day+" </br>"+
              "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Laudantium veniam exercitationem expedita laborum at voluptate. Labore, voluptates totam at aut nemo deserunt rem magni pariatur quos perspiciatis atque eveniet unde.</p>"+
          "<a class='btn btn-primary' id=gamelink" + element.id + ">View Game"+
            "<span class='glyphicon glyphicon-chevron-right'></span>"+
          "</a>"+
          "</div>"+"</div>"
                         ));
                $("#gamelink" + element.id).attr("href", path); 
                $("#gamelogolink" + element.id).attr("src", asset); 
                $("#gameimage" + element.id).attr("href", element.id);
                });
                },
                error: function () {
                alert("There is no more records or something went wrong");
                return false;
                }
        });
        });
    </script>
    <script type="text/javascript">
        $("#searchButton").click(function () {
        page = 1;
        $("#loading").html('<img id="loader-img alt="" src="http://shushei.site/uploads/logos/5f70f17f63fad1f9f28c7db384b74394.png" width="100" align="center">');
        var title = $("#search_game_searchTitle").val();
        var company = $("#search_game_searchCompany").val();
        var minDate = $("#search_game_minDate").val();
        var maxDate = $("#search_game_maxDate").val();
        criteria = {
        title: title,
                company: company,
                minDate: minDate,
                maxDate: maxDate}
        $(".gameRow").remove();
        $.ajax({
        method: "GET",
                url: "http://shushei.site/app_dev.php/api2/game/ajax/update",
                dataType: "json",
                contentType: "application/json",
                data: {page: page,
                        size: size,
                        criteria},
                success: function (a) {
                $("#loading").remove();
                
                $.each(a, function (key, element) {

                var date = new Date(element.release_date);
                var day = date.getDate();
                var month = date.getMonth() + 1;
                var year = date.getFullYear();
                $("#add").before(
                        $("<div class=gameRow id=game" + element.id + "></div>").html(
                        "<p>" + element.title +
                        "<p>" + element.company.company +
                        "<p>" + year + "-" + month + "-" + day +
                        "<p> <img src=http://shushei.site/uploads/logos/" + element.logo +
                        "><p><a id=gameimage" + element.id + ">View Game</a>"));
                $("#gameimage" + element.id).attr("href", element.id);
                });
                },
                error: function () {
                alert("There is no more records");
                return false;
                }
        });
        });

    </script>


{% endblock %}  {# empty Twig template #}
